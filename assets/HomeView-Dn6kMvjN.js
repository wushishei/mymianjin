import{t as e}from"./request-CMp-Rt37.js";import{A as t,C as n,D as r,E as i,N as a,O as o,T as s,_ as c,b as l,c as u,h as d,j as f,k as p,m,n as h,p as g,s as _,t as v,v as y,w as b,x,y as S}from"./index-DPV6HfP3.js";import{t as C}from"./ArticleItem-DJTQ4cZk.js";var w=`/mymianjin/assets/addmianjin-C5TxCTLn.png`;function T(t){return e.get(`/h5/interview/query`,{headers:{Authorization:h()},params:t})}function E(t){return e.get(`/h5/interview/query`,{headers:{Authorization:h()},params:{...t,sorter:`weight_ASC`}})}function D(t){return e.get(`/h5/interview/query`,{headers:{Authorization:h()},params:{...t,sorter:`weight_ASC`}})}var O={class:`home-view`},k={class:`my-nav van-hairline--bottom`},A={class:`article-list`},j={class:`load-more`},M={key:1,class:`no-more`},N=_(n({__name:`HomeView`,setup(e){let n=f([]),h=f([]),_=f([]),N=f([]),P=f(!1),F=f(!1),I=f(``),L=f(1),R=f(40),z=f(0),B=f(!1),V=f(!1),H=f(1),U=f(0),W=f(!1),G=(e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime(),K=()=>F.value?[..._.value].sort((e,t)=>t.likeCount-e.likeCount):P.value?[...h.value].sort(G):[...n.value].sort((e,t)=>t.likeCount-e.likeCount),q=e=>{P.value=e,F.value?W.value=!0:N.value=K()},J=async()=>{try{L.value=1,H.value=1,B.value=!0,V.value=!1,W.value=!1;let e=await T({current:L.value,pageSize:R.value}),t=await E({current:H.value,pageSize:R.value});h.value=t.data.data.rows,U.value=t.data.data.total,n.value=e.data.data.rows,z.value=e.data.data.total,N.value=K(),n.value.length>=z.value&&(V.value=!0),h.value.length>=U.value&&(W.value=!0)}catch(e){u(`获取数据失败，请稍后重试`),console.error(`获取数据失败:`,e)}finally{B.value=!1}};b(async()=>{await J(),window.addEventListener(`scroll`,Y)}),s(()=>{window.removeEventListener(`scroll`,Y)});let Y=()=>{let e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||window.innerHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;e+t>=n-200&&!B.value&&!V.value&&Z()},X=()=>{v.push({name:`addmianjin`})},Z=async()=>{if(!B.value){if(F.value){if(!P.value&&V.value)return}else if(P.value&&W.value||!P.value&&V.value)return;try{if(B.value=!0,F.value&&!P.value){L.value++;let e=await D({current:L.value,pageSize:R.value,stem:I.value.trim(),keyWord:I.value.trim()}),t=e.data.data.rows;z.value=e.data.data.total,_.value.push(...t),N.value=K(),V.value=_.value.length>=z.value}else if(P.value){H.value++;let e=await E({current:H.value,pageSize:R.value}),t=e.data.data.rows;U.value=e.data.data.total,h.value.push(...t),N.value=K(),h.value.length>=U.value&&(W.value=!0)}else{L.value++;let e=await T({current:L.value,pageSize:R.value}),t=e.data.data.rows;z.value=e.data.data.total,n.value.push(...t),N.value=K(),n.value.length>=z.value&&(V.value=!0)}}catch(e){u(`加载更多失败，请稍后重试`),console.error(`加载更多失败:`,e),F.value&&!P.value?L.value--:P.value?H.value--:L.value--}finally{B.value=!1}}},Q=e=>{v.push({name:`article`,params:{id:e}})},$=async()=>{if(!I.value.trim()){F.value=!1,V.value=!1,W.value=!1,await J();return}try{B.value=!0,F.value=!0;let e=await D({current:1,pageSize:R.value,stem:I.value.trim(),keyWord:I.value.trim()});_.value=e.data.data.rows,z.value=e.data.data.total,N.value=[..._.value].sort((e,t)=>t.likeCount-e.likeCount),V.value=_.value.length>=z.value,W.value=!0}catch(e){u(`搜索失败，请稍后重试`),console.error(`搜索失败:`,e)}finally{B.value=!1}};return(e,n)=>{let s=o(`van-loading`);return i(),l(`div`,O,[c(`nav`,k,[c(`a`,{class:a({active:!P.value}),href:`javascript:;`,onClick:n[0]||=e=>q(!1)},`推荐`,2),c(`a`,{class:a({active:P.value}),href:`javascript:;`,onClick:n[1]||=e=>q(!0)},`最新`,2),t(c(`input`,{type:`text`,placeholder:`搜索`,"onUpdate:modelValue":n[2]||=e=>I.value=e,onKeydown:m($,[`enter`])},null,544),[[g,I.value]]),c(`div`,{class:`logo`},[c(`img`,{src:w,alt:``,style:{"min-width":`40px`,height:`40px`,position:`relative`,top:`10px`},onClick:X}),n[3]||=c(`h1`,{class:`logo-text`},`面经`,-1)])]),c(`div`,A,[(i(!0),l(d,null,r(N.value,e=>(i(),y(C,{key:e.id,item:e,onClick:t=>Q(e.id)},null,8,[`item`,`onClick`]))),128))]),c(`div`,j,[B.value?(i(),y(s,{key:0,size:`20px`,color:`#999`,vertical:``},{default:p(()=>[...n[4]||=[x(` 加载中... `,-1)]]),_:1})):V.value?(i(),l(`span`,M,`没有更多数据了`)):S(``,!0)])])}}}),[[`__scopeId`,`data-v-a25ea23c`]]);export{N as default};